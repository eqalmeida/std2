<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="./WEB-INF/templates/templatePrincipal.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core">
    <ui:define name="top">

        <ui:include src="./WEB-INF/inc/logotipo.xhtml" />

    </ui:define>

    <ui:define name="left">
        <h:form id="fmenu">
            <p:menu>  

                <p:submenu icon="ui-icon-plus" label="Novo" >
                    <p:menuitem value="Veículo" actionListener="#{produtoBean.novoProduto(1)}" update=":formNewCar"/>
                    <p:menuitem value="Outro" actionListener="#{produtoBean.novoProduto(0)}" update=":formNewCar"/>
                </p:submenu>

                <p:submenu label="Selecionado" >
                    <p:menuitem disabled="#{produtoBean.selected.id eq null}" value="Editar" update=":formNewCar" actionListener="#{produtoBean.editar}" icon="ui-icon-pencil"/>  
                    <p:menuitem  disabled="#{produtoBean.selected.id eq null}" value="Excluir" update=":formTable" icon="ui-icon-trash" actionListener="#{produtoBean.excluir}" onstart="return confirm('Confirma?')"/>  
                    <p:menuitem  disabled="#{produtoBean.selected.id eq null}" value="Adicionar ao Pedido" update=":formTable" icon="ui-icon-plus" actionListener="#{produtoBean.addToPedido}"/>
                </p:submenu>

            </p:menu>

        </h:form>
    </ui:define>

    <ui:define name="content">
        <p:growl autoUpdate="true" id="message"/>

        <h:form id="formTable">
            <p:panelGrid columns="2" style="width:100%">

                            <p:selectOneButton value="#{produtoBean.tipoProduto}">
                                <f:selectItem itemValue="0" itemLabel="Outros" />
                                <f:selectItem itemValue="1" itemLabel="Veículos" />
                                <p:ajax update="tbl" listener="#{produtoBean.emEstoqueChanged}" />  
                            </p:selectOneButton>

                <h:panelGroup>
                            
                            <p:selectBooleanCheckbox value="#{produtoBean.emEstoque}">  
                                <p:ajax update="tbl" listener="#{produtoBean.emEstoqueChanged}" />  
                            </p:selectBooleanCheckbox>  
                            <h:outputText value="Não mostrar itens fora de estoque"/>
                </h:panelGroup>
            </p:panelGrid>
            <p:spacer height="2"/>

            <p:dataTable lazy="true" var="it" id="tbl" 
                         selectionMode="single" selection="#{produtoBean.selected}"
                         value="#{produtoBean.lazyList}" rows="10"
                         paginatorAlwaysVisible="false"
                         paginator="true">

                <p:ajax event="rowSelect"
                        update=":fmenu"/>  

                <p:ajax event="rowUnselect"
                        update=":fmenu"/>  

                <p:column headerText="Descrição" rendered="#{produtoBean.tipoProduto eq 0}">
                    #{it.descricaoGeral}
                </p:column>

                <p:column headerText="Placa" sortBy="#{it.placa}" rendered="#{produtoBean.tipoProduto eq 1}">
                    #{it.placa}
                </p:column>

                <p:column headerText="Fabricante" sortBy="#{it.fabricante}" rendered="#{produtoBean.tipoProduto eq 1}">
                    #{it.fabricante}
                </p:column>

                <p:column headerText="Modelo" sortBy="#{it.modelo}" rendered="#{produtoBean.tipoProduto eq 1}">
                    #{it.modelo}
                </p:column>

                <p:column headerText="Ano" sortBy="#{it.ano}" rendered="#{produtoBean.tipoProduto eq 1}">
                    #{it.ano}
                </p:column>

                <p:column headerText="Valor" sortBy="#{it.valor}">
                    <h:outputText  value="#{it.valor}" rendered="#{it.valor > 0.0}">
                        <f:convertNumber type="currency" />
                    </h:outputText>
                </p:column>

                <p:column headerText="Estoque" sortBy="#{it.qtdEstoque}"> 
                    <h:outputText value="#{it.qtdEstoque}" rendered="#{it.qtdEstoque >= 0}" />
                </p:column>


            </p:dataTable>

        </h:form>

        <h:form id="formNewCar">

            <p:dialog header="#{produtoBean.selected.id gt 0?'Editando':'Inserindo'} #{produtoBean.selected.tipo eq 0?'Produto':'Veículo'}"
                id="dlgNewCar" widgetVar="dialogNewCar" modal="true" resizable="false">

                <h:inputHidden value="#{produtoBean.selected.id}" />

                <p:panelGrid columns="#{2*(produtoBean.selected.tipo + 1)}" columnClasses="label,field,label,field" id="frm">

                    <h:outputText value="Placa:"  rendered="#{produtoBean.selected.tipo == 1}"/>
                    <p:inputText value="#{produtoBean.selected.placa}" required="true" maxlength="8" size="8" rendered="#{produtoBean.selected.tipo == 1}"/>

                    <h:outputText value="Fabricante:"  rendered="#{produtoBean.selected.tipo == 1}"/>
                    <p:inputText value="#{produtoBean.selected.fabricante}" required="true" rendered="#{produtoBean.selected.tipo == 1}"/>

                    <h:outputText value="Descrição:"  rendered="#{produtoBean.selected.tipo == 0}"/>
                    <p:inputText value="#{produtoBean.selected.descricao}" required="true" rendered="#{produtoBean.selected.tipo == 0}"/>

                    <h:outputText value="Modelo:"  rendered="#{produtoBean.selected.tipo == 1}"/>
                    <p:inputText value="#{produtoBean.selected.modelo}" required="true" rendered="#{produtoBean.selected.tipo == 1}"/>

                    <h:outputText value="Cilindradas:"  rendered="#{produtoBean.selected.tipo == 1}"/>
                    <p:inputText value="#{produtoBean.selected.cilindradas}" rendered="#{produtoBean.selected.tipo == 1}"/>

                    <h:outputText value="Ano:"  rendered="#{produtoBean.selected.tipo == 1}"/>
                    <p:inputText value="#{produtoBean.selected.ano}" required="true" rendered="#{produtoBean.selected.tipo == 1}"/>

                    <h:outputText value="Cor:" rendered="#{produtoBean.selected.tipo == 1}" />
                    <p:inputText value="#{produtoBean.selected.cor}" required="true" rendered="#{produtoBean.selected.tipo == 1}"/>

                    <h:outputText value="Combustível:" rendered="#{produtoBean.selected.tipo == 1}" />
                    <p:selectOneMenu value="#{produtoBean.selected.combustivel}"  rendered="#{produtoBean.selected.tipo == 1}">
                        <f:selectItems value="#{produtoBean.tipoCombustivel}" />
                    </p:selectOneMenu>

                    <h:outputText value="Chassi:"  rendered="#{produtoBean.selected.tipo == 1}"/>
                    <p:inputText value="#{produtoBean.selected.chassi}" rendered="#{produtoBean.selected.tipo == 1}"/>

                    <h:outputText value="Valor:" />
                    <p:inputText value="#{produtoBean.selected.valor}" styleClass="valor">
                        <f:convertNumber  pattern="#,##0.00"/>
                    </p:inputText>


                    <h:outputText value="Estoque: (-1 para não controlar)" />
                    <p:spinner min="-1" value="#{produtoBean.selected.qtdEstoque}" size="5"/>

                </p:panelGrid>

                <f:facet name="footer">
                    <p:commandButton value="Gravar" actionListener="#{produtoBean.inserir}" update=":formTable, frm"/>
                    <p:commandButton value="Cancela" oncomplete="dialogNewCar.hide()" immediate="true"/>
                </f:facet>

            </p:dialog>

        </h:form>
    </ui:define>

</ui:composition>
